<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Музыкальная страница</title>
	 <script>
       function base64ToBinary() {
            var base64Input = document.getElementById("base64Input").value;
            var binaryOutput = atob(base64Input)
                .split('')
                .map(function (char) {
                    return char.charCodeAt(0).toString(2).padStart(8, '0');
                })
                .join('');

            document.getElementById("binaryOutput").value = binaryOutput;
        }
		
		function convertBinaryToBase64() {
            const binaryInput = document.getElementById('binaryInput').value;
            const binary = binaryInput.replace(/\s/g, ''); // Remove white spaces from input

            if (!/^[01]+$/.test(binary)) {
                alert('Invalid binary input! Enter a sequence of 0s and 1s only.');
                return;
            }

            // Pad binary with leading zeros to make it a multiple of 6 bits
            const paddedBinary = binary.padEnd(Math.ceil(binary.length / 6) * 6, '0');

            let base64Output = '';
            for (let i = 0; i < paddedBinary.length; i += 6) {
                const binaryChunk = paddedBinary.substr(i, 6);
                const decimalValue = parseInt(binaryChunk, 2); // Convert binary to decimal
                const base64Char = getBase64Character(decimalValue);
                base64Output += base64Char;
            }

            document.getElementById('base64Output').textContent = base64Output;
        }

        function getBase64Character(decimal) {
            if (decimal >= 0 && decimal <= 25) {
                return String.fromCharCode(decimal + 65); // A-Z
            } else if (decimal >= 26 && decimal <= 51) {
                return String.fromCharCode(decimal + 71); // a-z
            } else if (decimal >= 52 && decimal <= 61) {
                return String.fromCharCode(decimal - 4); // 0-9
            } else if (decimal === 62) {
                return '+';
            } else if (decimal === 63) {
                return '/';
            }
        }
		
  </script>
</head>

<body>
    <button onclick="startMusic()">Start Music</button>
    <button onclick="stopMusic()">Stop Music</button>
    <br><br>
    <label for="tempoSlider">Adjust Tempo:</label>
    <input type="range" min="20" max="200" value="100" class="tempo-slider" id="tempoSlider">
    <span id="currentTempo">100 BPM</span>
    <br><br>
    <label for="musicInput">Enter Music Notes:</label>
    <input type="text" id="musicInput" placeholder="e.g., 123abc">
   
    
    <br><br>
	   <h1>Base64 to Binary Converter</h1>
    <label for="base64Input">Base64 Input:</label>
    <input type="text" id="base64Input" placeholder="Enter Base64 string" />
    <button onclick="base64ToBinary()">Convert</button>
    <br />
    <label for="binaryOutput">Binary Output:</label>
    <input type="text" id="binaryOutput" readonly />
	
	  <h1>Binary to Base64 Converter</h1>
    <input type="text" id="binaryInput" placeholder="Enter binary (e.g., 010101000100101)">
    <br><br>
    <button onclick="convertBinaryToBase64()">Convert</button>
    <br><br>
    <textarea id="base64Output" rows="5" cols="50" readonly></textarea>
    
    <script>
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let buffer, source;
        let tempo = 100;
        let isPlaying = false;

        function loadNoteBuffer(note, duration) {
            const frequencies = {
                '00000': 130.81,
'00001': 138.59,
'00010': 146.83,
'00011': 155.56,
'00100': 164.81,
'00101': 174.61,
'00110': 185.00,
'00111': 196.00,
'01000': 207.65,
'01001': 220.00,
'01010': 233.08,
'01011': 246.94,
'01100': 261.63,
'01101': 277.18,
'01110': 293.66,
'01111': 311.13,
'10000': 329.63,
'10001': 349.23,
'10010': 369.99,
'10011': 392.00,
'10100': 415.30,
'10101': 440.00,
'10110': 466.16,
'10111': 493.88,
'11000': 523.25,
'11001': 554.37,
'11010': 587.33,
'11011': 622.25,
'11100': 659.25,
'11101': 698.46,
'11110': null,
'11111': 0
            };

            const sampleRate = audioContext.sampleRate;
    const length = Math.ceil(sampleRate * duration);
    const buffer = audioContext.createBuffer(1, length, sampleRate);
    const data = buffer.getChannelData(0);

 if (frequencies[note] === null) {
        // Generate white noise samples
        for (let i = 0; i < length; i++) {
            data[i] = (Math.random() * 2 - 1)*0.2; // Generate random value between -1 and 1
        }
    } else {


    const attackTime = 0.01; // Time for the volume to reach its maximum amplitude (in seconds)
    const releaseTime = 0.02; // Time for the volume to reach zero (in seconds)
    const attackSamples = Math.ceil(sampleRate * attackTime);
    const releaseSamples = Math.ceil(sampleRate * releaseTime);
    const sustainSamples = length - attackSamples - releaseSamples;

    // Attack phase
    for (let i = 0; i < attackSamples; i++) {
        const envelopeValue = i / attackSamples;
        const t = i / sampleRate;
        data[i] = (frequencies[note] * Math.sin(2 * Math.PI * frequencies[note] * t) * envelopeValue) * 0.008;
    }

    // Sustain phase
    for (let i = attackSamples; i < attackSamples + sustainSamples; i++) {
        const t = i / sampleRate;
        data[i] = (frequencies[note] * Math.sin(2 * Math.PI * frequencies[note] * t)) * 0.008;
    }

    // Release phase
    for (let i = attackSamples + sustainSamples; i < length; i++) {
        const envelopeValue = 1 - ((i - attackSamples - sustainSamples) / releaseSamples);
        const t = i / sampleRate;
        data[i] = (frequencies[note] * Math.sin(2 * Math.PI * frequencies[note] * t) * envelopeValue) * 0.008;
    }
}
    return buffer;

        }

        function playNote(note, duration) {
            buffer = loadNoteBuffer(note, duration);
            source = audioContext.createBufferSource();
            source.buffer = buffer;
            source.connect(audioContext.destination);
            source.start();
        }

        function playMusic(index, music) {
            if (isPlaying && index < music.length) {
                let note = music[index];
                let duration = 0.125 * (100 / tempo);

                // Check for consecutive identical notes and extend duration
                while (index + 1 < music.length && music[index + 1] === note) {
                    duration += 0.125 * (100 / tempo);
                    index++;
                }

                playNote(note, duration);
                setTimeout(() => playMusic(index + 1, music), duration * 1000);
            } else if (isPlaying) {
                // Continue playing in a loop
                setTimeout(() => playMusic(0, music), 125 * (100 / tempo));
            }
        }

function splitTextIntoGroups(text, groupSize) {
    const groups = [];
    let i = 0;

    while (i < text.length) {
        const group = text.substr(i, groupSize);
        groups.push(group);
        i += groupSize;
    }

    return groups;
}

function startMusic() {
    const musicInput = document.getElementById('musicInput').value;
    if (!isPlaying && musicInput) {
        const musicGroups = splitTextIntoGroups(musicInput, 5); // Разделение текста по пять символов
        isPlaying = true;
        playMusic(0, musicGroups);
    }
}


       

        function stopMusic() {
            isPlaying = false;
            if (source) {
                source.stop(0);
                source.disconnect();
            }
        }

        const tempoSlider = document.getElementById('tempoSlider');
        const currentTempo = document.getElementById('currentTempo');

        tempoSlider.addEventListener('input', function () {
            tempo = parseInt(tempoSlider.value, 10);
            currentTempo.textContent = tempo + " BPM";
        });

      
    </script>
</body>

</html>